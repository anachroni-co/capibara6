<!DOCTYPE html>
<html lang="es" data-lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Chat con Capibara6 - IA Conversacional Avanzada">
    <title>Capibara6 Chat | Anachroni</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="chat.css?v=11.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Marked.js para renderizar Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <!-- Highlight.js para syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body class="chat-page">
    <!-- Barra lateral -->
    <aside id="sidebar" class="sidebar hidden">
        <div class="sidebar-header">
            <a href="index.html" class="sidebar-logo">
                <h1 class="logo-gradient">capibara6</h1>
            </a>
            <button id="new-chat-btn" class="btn-new-chat">
                <i data-lucide="edit-3" style="width: 20px; height: 20px;"></i>
                <span data-i18n="chat.new">Nueva Conversaci√≥n</span>
            </button>
        </div>

        <div class="sidebar-content">
            <!-- Informaci√≥n del usuario -->
            <div id="user-info" class="user-info" style="display: none;">
                <img src="" alt="Avatar" class="user-avatar">
                <div class="user-details">
                    <span class="user-name">Usuario</span>
                    <span class="user-provider">provider</span>
                </div>
            </div>
            
            <!-- Tabs para Conversaciones / Agentes / Gemelo Digital -->
            <div class="sidebar-tabs">
                <button class="sidebar-tab active" data-tab="chats">
                    <i data-lucide="messages-square" style="width: 16px; height: 16px;"></i>
                    <span data-i18n="sidebar.chats">Chats</span>
                </button>
                <button class="sidebar-tab" data-tab="agents">
                    <i data-lucide="sparkles" style="width: 16px; height: 16px;"></i>
                    <span data-i18n="sidebar.agents">Agentes</span>
                </button>
                <button class="sidebar-tab" data-tab="digital-twin">
                    <i data-lucide="brain" style="width: 16px; height: 16px;"></i>
                    <span data-i18n="sidebar.digitalTwin">Gemelo Digital</span>
                </button>
            </div>

            <!-- Tab: Conversaciones -->
            <div id="tab-chats" class="tab-content active">
                <div class="sidebar-section">
                    <h3 class="sidebar-section-title" data-i18n="chat.today">Hoy</h3>
                    <div id="chats-today" class="chat-list">
                        <!-- Se llenar√°n din√°micamente -->
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3 class="sidebar-section-title" data-i18n="chat.previous">Anteriores</h3>
                    <div id="chats-previous" class="chat-list">
                        <!-- Se llenar√°n din√°micamente -->
                    </div>
                </div>
            </div>

            <!-- Tab: Agentes -->
            <div id="tab-agents" class="tab-content">
                <div class="agents-header">
                    <button id="create-agent-btn" class="btn-create-agent">
                        <i data-lucide="wand-2" style="width: 18px; height: 18px;"></i>
                        <span data-i18n="agents.create">Crear Agente</span>
                    </button>
                </div>
                <div id="agents-list" class="agents-list">
                    <!-- Se llenar√°n din√°micamente -->
                </div>
            </div>

            <!-- Tab: Gemelo Digital -->
            <div id="tab-digital-twin" class="tab-content">
                <div class="digital-twin-container">
                    <div class="digital-twin-header">
                        <div class="twin-icon">
                            <i data-lucide="brain" style="width: 24px; height: 24px;"></i>
                        </div>
                        <h3 data-i18n="digitalTwin.title">Gemelo Digital</h3>
                        <p class="twin-subtitle" data-i18n="digitalTwin.subtitle">Entrena tu ego sint√©tico con tus datos</p>
                    </div>

                    <div class="training-status">
                        <div class="status-badge" id="twin-status">
                            <i data-lucide="circle" style="width: 8px; height: 8px;"></i>
                            <span data-i18n="digitalTwin.notTrained">No entrenado</span>
                        </div>
                        <div class="training-progress" style="display: none;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="training-progress"></div>
                            </div>
                            <span class="progress-text" id="progress-text">0%</span>
                        </div>
                    </div>

                    <div class="data-sources">
                        <h4 class="sources-title" data-i18n="digitalTwin.sources">Fuentes de Datos</h4>
                        <p class="sources-hint" data-i18n="digitalTwin.hint">Sube tus conversaciones exportadas de estas plataformas</p>

                        <div class="source-list">
                            <div class="source-item" data-source="twitter">
                                <div class="source-icon" style="background: linear-gradient(135deg, #1DA1F2, #0d8bd9);">
                                    <i data-lucide="twitter" style="width: 20px; height: 20px;"></i>
                                </div>
                                <div class="source-info">
                                    <span class="source-name">X (Twitter)</span>
                                    <span class="source-status" data-i18n="digitalTwin.notUploaded">Sin datos</span>
                                </div>
                                <button class="btn-upload" onclick="uploadData('twitter')">
                                    <i data-lucide="upload" style="width: 16px; height: 16px;"></i>
                                </button>
                            </div>

                            <div class="source-item" data-source="facebook">
                                <div class="source-icon" style="background: linear-gradient(135deg, #1877F2, #0c5bbf);">
                                    <i data-lucide="facebook" style="width: 20px; height: 20px;"></i>
                                </div>
                                <div class="source-info">
                                    <span class="source-name">Facebook</span>
                                    <span class="source-status" data-i18n="digitalTwin.notUploaded">Sin datos</span>
                                </div>
                                <button class="btn-upload" onclick="uploadData('facebook')">
                                    <i data-lucide="upload" style="width: 16px; height: 16px;"></i>
                                </button>
                            </div>

                            <div class="source-item" data-source="instagram">
                                <div class="source-icon" style="background: linear-gradient(135deg, #E1306C, #C13584, #833AB4);">
                                    <i data-lucide="instagram" style="width: 20px; height: 20px;"></i>
                                </div>
                                <div class="source-info">
                                    <span class="source-name">Instagram</span>
                                    <span class="source-status" data-i18n="digitalTwin.notUploaded">Sin datos</span>
                                </div>
                                <button class="btn-upload" onclick="uploadData('instagram')">
                                    <i data-lucide="upload" style="width: 16px; height: 16px;"></i>
                                </button>
                            </div>

                            <div class="source-item" data-source="whatsapp">
                                <div class="source-icon" style="background: linear-gradient(135deg, #25D366, #1ead5a);">
                                    <i data-lucide="message-circle" style="width: 20px; height: 20px;"></i>
                                </div>
                                <div class="source-info">
                                    <span class="source-name">WhatsApp</span>
                                    <span class="source-status" data-i18n="digitalTwin.notUploaded">Sin datos</span>
                                </div>
                                <button class="btn-upload" onclick="uploadData('whatsapp')">
                                    <i data-lucide="upload" style="width: 16px; height: 16px;"></i>
                                </button>
                            </div>

                            <div class="source-item" data-source="telegram">
                                <div class="source-icon" style="background: linear-gradient(135deg, #0088cc, #006699);">
                                    <i data-lucide="send" style="width: 20px; height: 20px;"></i>
                                </div>
                                <div class="source-info">
                                    <span class="source-name">Telegram</span>
                                    <span class="source-status" data-i18n="digitalTwin.notUploaded">Sin datos</span>
                                </div>
                                <button class="btn-upload" onclick="uploadData('telegram')">
                                    <i data-lucide="upload" style="width: 16px; height: 16px;"></i>
                                </button>
                            </div>

                            <div class="source-item" data-source="chatgpt">
                                <div class="source-icon" style="background: linear-gradient(135deg, #10a37f, #0d8f6d);">
                                    <i data-lucide="bot" style="width: 20px; height: 20px;"></i>
                                </div>
                                <div class="source-info">
                                    <span class="source-name">ChatGPT</span>
                                    <span class="source-status" data-i18n="digitalTwin.notUploaded">Sin datos</span>
                                </div>
                                <button class="btn-upload" onclick="uploadData('chatgpt')">
                                    <i data-lucide="upload" style="width: 16px; height: 16px;"></i>
                                </button>
                            </div>

                            <div class="source-item" data-source="claude">
                                <div class="source-icon" style="background: linear-gradient(135deg, #D97757, #c76646);">
                                    <i data-lucide="zap" style="width: 20px; height: 20px;"></i>
                                </div>
                                <div class="source-info">
                                    <span class="source-name">Claude</span>
                                    <span class="source-status" data-i18n="digitalTwin.notUploaded">Sin datos</span>
                                </div>
                                <button class="btn-upload" onclick="uploadData('claude')">
                                    <i data-lucide="upload" style="width: 16px; height: 16px;"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="twin-actions">
                        <button id="train-twin-btn" class="btn-train-twin" disabled>
                            <i data-lucide="brain" style="width: 18px; height: 18px;"></i>
                            <span data-i18n="digitalTwin.train">Entrenar Gemelo Digital</span>
                        </button>
                        <button id="export-twin-btn" class="btn-export-twin" disabled>
                            <i data-lucide="download" style="width: 18px; height: 18px;"></i>
                            <span data-i18n="digitalTwin.export">Exportar</span>
                        </button>
                    </div>

                    <div class="twin-info">
                        <div class="info-card">
                            <i data-lucide="shield-check" style="width: 20px; height: 20px;"></i>
                            <div>
                                <strong data-i18n="digitalTwin.security">Seguridad</strong>
                                <p data-i18n="digitalTwin.securityDesc">Datos encriptados con AES-256</p>
                            </div>
                        </div>
                        <div class="info-card">
                            <i data-lucide="lock" style="width: 20px; height: 20px;"></i>
                            <div>
                                <strong data-i18n="digitalTwin.privacy">Privacidad</strong>
                                <p data-i18n="digitalTwin.privacyDesc">Procesamiento local, sin servidores externos</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="sidebar-footer">
            <button class="sidebar-user-btn">
                <div class="user-avatar">
                    <i data-lucide="circle-user" style="width: 20px; height: 20px;"></i>
                </div>
                <div class="user-info">
                    <div class="user-name">Usuario</div>
                    <div class="user-plan">Plan Gratuito</div>
                </div>
                <i data-lucide="chevron-up" style="width: 20px; height: 20px;"></i>
            </button>
        </div>
    </aside>

    <!-- Overlay para cerrar sidebar al hacer click fuera -->
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <!-- Bot√≥n para mostrar/ocultar sidebar en m√≥vil -->
    <button id="sidebar-toggle" class="sidebar-toggle" aria-label="Toggle Sidebar">
        <i data-lucide="panel-left" style="width: 24px; height: 24px;"></i>
    </button>

    <!-- √Årea principal del chat -->
    <main class="chat-main">
        <!-- Contenedor del contenido del chat -->
        <div class="chat-content-wrapper">
        <!-- Vista vac√≠a (sin conversaci√≥n seleccionada) -->
        <div id="empty-state" class="empty-state">
            <div class="empty-state-content">
                <div class="capibara-logo-large">
                    <h1 class="logo-gradient">capibara6</h1>
                </div>
                <h2 class="empty-state-title" data-i18n="chat.empty.title">¬øEn qu√© puedo ayudarte hoy?</h2>
                <p class="empty-state-subtitle" data-i18n="chat.empty.subtitle">Tu asistente de IA avanzado con arquitectura h√≠brida Transformer-Mamba</p>
                
                <div class="suggestion-cards">
                    <button class="suggestion-card" data-prompt="Expl√≠came c√≥mo funciona la arquitectura h√≠brida Transformer-Mamba">
                        <i data-lucide="network" style="width: 24px; height: 24px;"></i>
                        <div>
                            <div class="suggestion-title" data-i18n="chat.suggestion1.title">Arquitectura H√≠brida</div>
                            <div class="suggestion-text" data-i18n="chat.suggestion1.text">Expl√≠came c√≥mo funciona</div>
                        </div>
                    </button>
                    
                    <button class="suggestion-card" data-prompt="¬øQu√© ventajas tiene usar Google TPU v6e-64 para entrenar modelos?">
                        <i data-lucide="cpu" style="width: 24px; height: 24px;"></i>
                        <div>
                            <div class="suggestion-title" data-i18n="chat.suggestion2.title">Google TPU</div>
                            <div class="suggestion-text" data-i18n="chat.suggestion2.text">Ventajas para entrenamiento</div>
                        </div>
                    </button>
                    
                    <button class="suggestion-card" data-prompt="Ay√∫dame a escribir c√≥digo Python para procesar datos con eficiencia">
                        <i data-lucide="terminal" style="width: 24px; height: 24px;"></i>
                        <div>
                            <div class="suggestion-title" data-i18n="chat.suggestion3.title">Programaci√≥n</div>
                            <div class="suggestion-text" data-i18n="chat.suggestion3.text">Ayuda con c√≥digo Python</div>
                        </div>
                    </button>
                    
                    <button class="suggestion-card" data-prompt="¬øC√≥mo puedo mejorar el rendimiento de mi aplicaci√≥n web?">
                        <i data-lucide="gauge" style="width: 24px; height: 24px;"></i>
                        <div>
                            <div class="suggestion-title" data-i18n="chat.suggestion4.title">Optimizaci√≥n</div>
                            <div class="suggestion-text" data-i18n="chat.suggestion4.text">Mejorar rendimiento web</div>
                        </div>
                    </button>
                </div>
            </div>
        </div>

        <!-- √Årea de conversaci√≥n -->
        <div id="chat-area" class="chat-area" style="display: none;">
            <div class="chat-header">
                <button id="sidebar-toggle-header" class="btn-icon">
                    <i data-lucide="panel-left" style="width: 20px; height: 20px;"></i>
                </button>
                <div class="chat-title">
                    <span id="current-chat-title">Nueva Conversaci√≥n</span>
                </div>
                <div class="chat-actions">
                    <!-- Indicador de estado del servidor -->
                    <div class="server-status" id="server-status" title="Estado del servidor">
                        <div class="status-led" id="status-led"></div>
                        <span class="status-text" id="status-text">Desconectado</span>
                    </div>
                    <!-- Indicador de consenso/modelos -->
                    <div class="consensus-indicator" id="consensus-indicator" title="Modelos activos en consenso">
                        <i data-lucide="network" style="width: 16px; height: 16px;"></i>
                        <span class="consensus-count" id="consensus-count">1</span>
                    </div>
                    <button class="btn-icon" title="Compartir" data-i18n-title="chat.share">
                        <i data-lucide="link-2" style="width: 20px; height: 20px;"></i>
                    </button>
                    <button class="btn-icon" title="Configuraci√≥n" data-i18n-title="chat.settings">
                        <i data-lucide="sliders-horizontal" style="width: 20px; height: 20px;"></i>
                    </button>
                </div>
            </div>

            <!-- Banner Beta Experimental -->
            <div class="beta-banner">
                <i data-lucide="flask-conical" style="width: 16px; height: 16px;"></i>
                <span><strong>Versi√≥n Beta Experimental</strong> - Esta aplicaci√≥n est√° en desarrollo activo. Pueden ocurrir errores o cambios inesperados.</span>
                <button class="beta-banner-close" onclick="this.parentElement.style.display='none'" title="Cerrar">
                    <i data-lucide="x" style="width: 14px; height: 14px;"></i>
                </button>
            </div>

            <div id="messages-container" class="messages-container">
                <!-- Los mensajes se agregar√°n aqu√≠ din√°micamente -->
            </div>

            <!-- √Årea de input -->
            <div class="chat-input-container">
                <!-- Archivos adjuntos -->
                <div id="attachments-preview" class="attachments-preview" style="display: none;"></div>
                
                <div class="chat-input-wrapper">
                    <button id="attach-btn" class="btn-icon" title="Adjuntar archivo" data-i18n-title="chat.attach">
                        <i data-lucide="plus-circle" style="width: 20px; height: 20px;"></i>
                    </button>
                    <input type="file" id="file-input" style="display: none;" multiple accept="image/*,.pdf,.doc,.docx,.txt,.csv,.xlsx,.xls,.pptx,.ppt,.zip,.rar">
                    
                    <textarea 
                        id="message-input" 
                        class="message-input" 
                        placeholder="Escribe tu mensaje aqu√≠..."
                        data-i18n-placeholder="chat.input.placeholder"
                        rows="1"
                    ></textarea>
                    
                    <button id="send-btn" class="btn-send" disabled>
                        <i data-lucide="arrow-up" style="width: 20px; height: 20px;"></i>
                    </button>
                </div>
                <div class="chat-input-footer">
                    <span class="input-hint" data-i18n="chat.input.hint">
                        Capibara6 puede cometer errores. Considera verificar informaci√≥n importante.
                    </span>
                </div>
            </div>
        </div>
        </div> <!-- Cierre de chat-content-wrapper -->
    </main>

    <!-- Modal de configuraci√≥n -->
    <div id="settings-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="settings.title">Configuraci√≥n</h2>
                <button class="modal-close" onclick="closeSettingsModal()">
                    <i data-lucide="x-circle" style="width: 24px; height: 24px;"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <label class="setting-label" data-i18n="settings.model">Modelo</label>
                    <select class="setting-select">
                        <option value="capibara6">Capibara6 (Est√°ndar)</option>
                        <option value="capibara6-fast">Capibara6 Fast</option>
                        <option value="capibara6-advanced">Capibara6 Advanced</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label class="setting-label" data-i18n="settings.temperature">Temperatura (Creatividad)</label>
                    <input type="range" class="setting-range" min="0" max="1" step="0.1" value="0.7">
                    <span class="setting-value">0.7</span>
                </div>
                <div class="setting-group">
                    <label class="setting-label" data-i18n="settings.language">Idioma</label>
                    <select class="setting-select" id="language-select">
                        <option value="es">Espa√±ol</option>
                        <option value="en">English</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <script src="translations.js?v=5.0"></script>
    <script src="entropy-monitor.js?v=5.0"></script>
    <!-- <script src="mcp-integration.js"></script> MCP v1 (reemplazado por Smart MCP v2) -->
    <script src="smart-mcp-integration.js?v=11.0"></script>
    <!-- <script src="consensus-integration.js"></script> Pausado: Activar m√°s tarde -->
    <script src="template-profiles.js?v=5.0"></script>
    <script src="rating-system.js?v=5.0"></script>
    <script src="tts-integration.js?v=18.0"></script>
    <script src="digital-twin.js?v=1.0"></script>
    <script src="chat-app.js?v=35.0&t=1736987000"></script>
    <script src="entropy-auto-inject.js?v=5.0"></script>
    <script>
        // Verificaci√≥n de carga de m√≥dulos
        console.log('üîç Verificando m√≥dulos cargados...');
        console.log('‚úì Lucide:', typeof lucide);
        console.log('‚úì Marked:', typeof marked);
        console.log('‚úì Template Profiles:', typeof window.TEMPLATE_PROFILES);
        console.log('‚úì Rating System:', typeof window.showRatingModal);
        console.log('‚úì Smart MCP:', typeof window.smartMCPAnalyze);

        // Inicializar iconos de Lucide
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
            console.log('‚úÖ Iconos de Lucide inicializados');
        } else {
            console.error('‚ùå Lucide no cargado');
        }

        // Manejar clics en tabs del sidebar
        document.addEventListener('DOMContentLoaded', () => {
            // Tabs del sidebar
            const sidebarTabs = document.querySelectorAll('.sidebar-tab');
            const tabContents = document.querySelectorAll('.tab-content');

            sidebarTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');

                    // Remover clase active de todos los tabs
                    sidebarTabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));

                    // Agregar clase active al tab clickeado
                    tab.classList.add('active');

                    // Mostrar el contenido correspondiente
                    const targetContent = document.getElementById(`tab-${tabId}`);
                    if (targetContent) {
                        targetContent.classList.add('active');
                    }

                    // Reinicializar iconos de Lucide
                    if (typeof lucide !== 'undefined') {
                        lucide.createIcons();
                    }
                });
            });
        });
    </script>
</body>
</html>

